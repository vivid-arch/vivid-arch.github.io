<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="Vivid Jobs">

        <meta property="og:site_name" content="Laravel Vivid"/>
        <meta property="og:title" content="Jobs | Laravel Vivid"/>
        <meta property="og:description" content="Vivid Jobs"/>
        <meta property="og:url" content="https://vivid-arch.github.io/docs/foundation/jobs"/>
        <meta property="og:image" content="/assets/img/logo.png"/>
        <meta property="og:type" content="website"/>

        <meta name="twitter:image:alt" content="Laravel Vivid">
        <meta name="twitter:card" content="summary_large_image">

        
        <title>Laravel Vivid | Jobs</title>

        <link rel="home" href="https://vivid-arch.github.io/">
        <link rel="icon" href="/favicon.ico">

        
                    <!-- Insert analytics code here -->
        
        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i,800,800i" rel="stylesheet">
        <link rel="stylesheet" href="/assets/build/css/main.css?id=3a7955c2061c89fe3394">

            </head>

    <body class="flex flex-col justify-between min-h-screen bg-gray-100 text-gray-800 leading-normal font-sans">
        <header class="flex items-center shadow bg-white border-b h-24 mb-8 py-4" role="banner">
            <div class="container flex items-center max-w-8xl mx-auto px-4 lg:px-8">
                <div class="flex items-center">
                    <a href="/" title="Laravel Vivid home" class="inline-flex items-center">
                        <img class="h-8 md:h-10 mr-3" src="/assets/images/Vivid-01.png" alt="Laravel Vivid logo" />

                        <h1 class="text-lg md:text-2xl text-blue-900 font-semibold hover:text-blue-600 my-0 pr-4">Laravel Vivid</h1>
                    </a>
                </div>

                <div class="flex flex-1 justify-end items-center text-right md:pl-10">
                                    </div>
            </div>

                <button class="flex justify-center items-center bg-blue-500 border border-blue-500 h-10 mr-4 px-5 rounded-full lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

        </header>

        <main role="main" class="w-full flex-auto">
            <section class="container max-w-8xl mx-auto px-6 md:px-8 py-4">
    <div class="flex flex-col lg:flex-row">
        <nav id="js-nav-menu" class="nav-menu hidden lg:block">
            <ul class="my-0">
            <li class="pl-4">
            
        <a href="/docs/foundation/getting-started"
            class="lvl0 lvl0-active  nav-menu__item hover:text-blue-500"
        >
            Foundation
        </a>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/docs/foundation/installation"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Installation
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/foundation/devices"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Devices
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/foundation/controllers"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Controllers
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/foundation/features"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Features
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/foundation/jobs"
            class="lvl1  active font-semibold text-blue-500 nav-menu__item hover:text-blue-500"
        >
            Jobs
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/foundation/domains"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Domains
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/foundation/operations"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Operations
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/foundation/resources"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Resources
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/foundation/views"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Views
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/foundation/events"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Events
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/foundation/logging"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Logging
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/foundation/instance"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Instance
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/docs/console/getting-started"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Console
        </a>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/docs/console/commands"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Commands
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/docs/ignition/getting-started"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Ignition Tab
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/changelog"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            CHANGELOG
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/roadmap"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            ROADMAP
        </a>
    
    </li>
    </ul>
        </nav>

        <div class="w-full lg:w-3/5 break-words pb-16 lg:pl-4" v-pre>
            <h1>Jobs</h1>

<p>Jobs are where most of the magic happens. They are responsible for doing a certain task, and they are reusable throughout the application.</p>

<p>Jobs should only be doing one and only thing. For example, a <code>FetchActiveUsersJob</code> should do exactly what the name implies. 
Similarly, the Feature should be broken down to individual jobs. 
If you were to have a <code>SavePostFeature</code> you should think what smaller steps need to take place in order to accomplish that task.</p>

<p>Unlike Features, Jobs are not Device-specific, and they reside inside the <code>/app/Domains/&lt;domain&gt;/Jobs</code> directory. 
One important characteristic of the Jobs is that they are completely isolated, and they should only ever talk to the core application or other external services. 
Most importantly, Jobs should never talk to other jobs.</p>

<p>Furthermore, you should accept Job parameters in such a way which should allow Jobs to be executed in a non-HTTP context too.</p>

<h2>Generating a Job</h2>

<p><strong>Basic use</strong></p>

<p>To generate a Job, use the following command:</p>

<pre><code class="language-sh">./vendor/bin/vivid make:job &lt;job&gt; &lt;domain&gt;
</code></pre>

<h2>Anatomy of the Job</h2>

<pre><code class="language-php">&lt;?php

namespace App\Domains\ExampleDomain\Jobs;

use Vivid\Foundation\Job;

class ExampleJob extends Job
{
    /**
     * Create a new job instance.
     *
     * @return void
     */
    public function __construct()
    {

    }

    /**
     * Execute the job.
     *
     * @return void
     */
    public function handle()
    {

    }
}

</code></pre>

<p>By default, the Job will contain 2 methods, the <code>__construct</code> and the <code>handle</code>. You will use the constructor in order to
accept parameters, and the handle method to place inside the main Job logic. 
If you wish you may add your own methods to clean up the <code>handle</code> method.</p>

<h2>Running Jobs</h2>

<p>To run a job you will use the <code>$this-&gt;run()</code> method from within a Feature, which is made available by the <code>Vivid\Foundation\JobDispatcherTrait</code>.</p>

<p>Here is an example:</p>

<pre><code class="language-php">&lt;?php

namespace App\Devices\ExampleDevice\Features;

use Vivid\Foundation\Feature;
use Illuminate\Http\Request;

use App\Domains\ExampleDomain\Jobs\ExampleJob;

class ExampleFeature extends Feature
{
    public function handle(Request $request)
    {
        return $this-&gt;run(ExampleJob::class);
    }
}

</code></pre>

<p>Sometimes you may wish you run a Job if a certain condition is met. Vivid provides 2 support methods which can help you with that.</p>

<ul>
<li><code>$this-&gt;runIf(boon $condition, string $job, array $args)</code></li>
<li><code>$this-&gt;runUnless(boon $condition, string $job, array $args)</code></li>
</ul>

<h2>Passing Parameters</h2>

<p>You can pass parameters similar to how you would do it with Features.</p>

<p>The <code>$this-&gt;run()</code> method will accept an associative array as a second parameter and will inject the values
to the constructor of the Job.</p>

<pre><code class="language-php">[...]

public function handle(Request $request)
{
    $this-&gt;run(ExampleJob::class, [
        'param1' =&gt; 'value',
        'param2' =&gt; 'value'
    ]);
}

[...]
</code></pre>

<p>In order to accept these parameters from the Job class you will do the following:</p>

<pre><code class="language-php">[...]

class ExampleJob extends Job
{
    private $param1;
    private $param2;

    /**
     * Create a new job instance.
     *
     * @return void
     */
    public function __construct($param1, $param2)
    {
        $this-&gt;param1 = $param1;
        $this-&gt;param2 = $param2;
    }

    /**
     * Execute the job.
     *
     * @return void
     */
    public function handle()
    {
        // use the parameters from within here
    }
}

</code></pre>

<p>If you are running PHP8 you can use the <a href="https://stitcher.io/blog/constructor-promotion-in-php-8">Constructor Property Promotion</a> in order to reduce the number of lines written. Given our
previous example, it can be written as:</p>

<pre><code class="language-php">class ExampleJob extends Job
{
    /**
     * Create a new job instance.
     *
     * @return void
     */
    public function __construct(private $param1, private $param2)
    {}

    /**
     * Execute the job.
     *
     * @return void
     */
    public function handle()
    {
        // use the parameters from within here
    }
}
</code></pre>

<p>You can read more about Constructor Property Promotion in the <a href="https://wiki.php.net/rfc/constructor_promotion">official RFP</a>.</p>

<p>Please note that the order of the parameters does not matter here either. The key of the associative array however has to match the name of the parameter.</p>

<h2>Returning data from Jobs</h2>

<p>In most cases you need to return whatever the result of the Job is. The <code>run</code> method will return whatever <code>handle</code> returns.</p>

<p>Here is an example:</p>

<p><strong>Feature:</strong></p>

<pre><code>$data = $this-&gt;run(ExampleJob::class, [
    'param1' =&gt; 'value',
    'param2' =&gt; 'value'
]);
</code></pre>

<p><strong>Job:</strong></p>

<pre><code class="language-php">public function handle() {
    // whatever $data is....
    return $data;
}
</code></pre>

<h2>Cacheable Jobs</h2>

<p>It is also possible to implement automatic caching for Job. Basically, the Vivid job dispatcher
will take the result of the Job and add it to the default caching driver.</p>

<p>To make a Job cacheable, you need to implement the following interface: <code>Vivid\Foundation\Contracts\Cacheable</code>.</p>

<p>This interface is responsible for requesting 2 essential pieces of information: What the key is &amp; how long to cache.</p>

<pre><code class="language-php">public function getCacheKey(): string;

public function getCacheExpiration(): int;
</code></pre>

<p>For convenience, Vivid includes a trait out of the box which can use a set of default values 
in order to provide a definition for the <code>getCacheKey</code> and <code>getCacheExpiration</code> methods.
Simply use the <code>Vivid\Foundation\Contracts\Cacheable</code> trait.</p>

<p>The <code>getCacheKey</code> method will return the class FQN of the Job and the <code>getCacheExpiration</code> will
return the value of <code>default_cache_duration</code> which is located in <code>config/vivid.php</code>.</p>
        </div>
    </div>
</section>
        </main>

        <script src="/assets/build/js/main.js?id=25e9d4a401264f358321"></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-44791239-17"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-44791239-17');
        </script>

        <footer class="bg-white text-center text-sm mt-12 py-4" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center">
                <li class="md:mr-2">
                    &copy; <a href="#" title="Tighten website">Vivid</a> 2021.
                </li>

                <li>
                    Built with <a href="http://jigsaw.tighten.co" title="Jigsaw by Tighten">Jigsaw</a>
                    and <a href="https://tailwindcss.com" title="Tailwind CSS, a utility-first CSS framework">Tailwind CSS</a>.
                </li>
            </ul>
        </footer>
    </body>
</html>
